library(gt)
va_covid <- readRDS("va_covid")

#cumsum takes in a vector x of numeric values and returns a vector y
#which stores the cumulative sum; y[i] is the cumulative value of x[1],x[2]
#,...,x[i]
cumsum <- function(x)
{
  y <- vector(length = length(x))
  for (i in 1:length(y))
  {
    y[i] <- sum(x[1:i])
  }
  return(y)
}

#this function will calculate summary statistics for a specific district
summary_given_district <- function(X,district)
{
  #breakup the dataframe X using the input district and then by type of
  #statistic
  X.district <- subset(X,health_district == district)
  X.district.cases <- subset(X.district,statistic == "cases")
  X.district.hospital <- subset(X.district,statistic == "hospitalizations")
  X.district.deaths <- subset(X.district,statistic == "deaths")
  
  #calculate the mean cases, hospitalizations, deaths
  mean_cases <- mean(X.district.cases$count)
  mean_hospital <- mean(X.district.hospital$count)
  mean_deaths <- mean(X.district.deaths$count)
  
  #calculate the median cases, hospitalizations, deaths 
  median_cases <- median(X.district.cases$count)
  median_hospital <- median(X.district.hospital$count)
  median_deaths <- median(X.district.deaths$count)
  
  #calculate the standard deviation of the cases, hospitalizations, deaths 
  sd_cases <- sd(X.district.cases$count)
  sd_hospital <- sd(X.district.hospital$count)
  sd_deaths <- sd(X.district.deaths$count)
  #bind the means,medians, and standard deviations as well as a description
  #column
  means <- rbind(mean_cases, mean_hospital,mean_deaths)
  medians <- rbind(median_cases,median_hospital,median_deaths)
  standard_devs <- rbind(sd_cases,sd_hospital,sd_deaths)
  description <- c("Cases", "Hospitalizations","Deaths")
  #form the final data frame, give the column names and then convert to a table
  summary <- data.frame(cbind(description,round(means,3),round(medians,3),round(standard_devs,3)))
  names(summary) <- c("Type","Means","Median","Standard Deviation")
  #final_table is the final table object
  final_table <- summary %>% gt() %>% tab_spanner(label = "Statistic",columns = vars("Means","Median","Standard Deviation"))
}

#here is an example. simply pass in the inputs and then use print to see the table
print(summary_given_district(X = va_covid,district = "Fairfax"))
