library(gt)
va_data <- readRDS("va_data")

#cumsum takes in a vector x of numeric values and returns a vector y
#which stores the cumulative sum; y[i] is the cumulative value of x[1],x[2]
#,...,x[i]
cumsum <- function(x)
{
  y <- vector(length = length(x))
  for (i in 1:length(y))
  {
    y[i] <- sum(x[1:i])
  }
  return(y)
}

#this function will calculate summary statistics for a specific district
summary_given_district <- function(X,district)
{
  #breakup the dataframe X using the input district and then by type of
  #statistic
  X.district <- subset(X,health_district == district)
  X.district.cases <- subset(X.district,statistic == "cases")
  X.district.hospital <- subset(X.district,statistic == "hospitalizations")
  X.district.deaths <- subset(X.district,statistic == "deaths")
  
  #calculate the cumulative counts of cases, hospitalizations, and deaths
  cum_count.cases <- cumsum(X.district.cases$count)
  cum_count.hospital <- cumsum(X.district.hospital$count)
  cum_count.deaths <- cumsum(X.district.deaths$count)
  
  #calculate the mean cases, hospitalizations, deaths for the health district
  mean_cases <- mean(X.district.cases$count)
  mean_hospital <- mean(X.district.hospital$count)
  mean_deaths <- mean(X.district.deaths$count)
  
  #calculate the median cases, hospitalizations, deaths for the health district
  median_cases <- median(X.district.cases$count)
  median_hospital <- median(X.district.hospital$count)
  median_deaths <- median(X.district.deaths$count)
  
  #calculate the variance of the cases, hospitalizations, deaths for the health district
  var_cases <- var(X.district.cases$count)
  var_hospital <- var(X.district.hospital$count)
  var_deaths <- var(X.district.deaths$count)
  
  means <- rbind(mean_cases, mean_hospital,mean_deaths)
  medians <- rbind(median_cases,median_hospital,median_deaths)
  variances <- rbind(var_cases,var_hospital,var_deaths)
  
  summary <- data.frame(cbind(means,medians,variances))
  names(summary) <- c("Means","Median","Variance")
  rownames(summary) <- c("Cases","Hospitalizations","Deaths")
  return(summary)
}

summary_given_district(X = va_data,district = "Fairfax") %>% gt() %>% tab_header(title = "Summary Statistics") %>% fmt_number(columns = vars("Cases","Hospitalizations","Deaths"))
